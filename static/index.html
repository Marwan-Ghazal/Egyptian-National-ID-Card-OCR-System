
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>National ID Scanner</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen w-full bg-gradient-to-br from-[#030711] via-[#0b1220] to-[#051a2f] text-white">
  <div class="max-w-6xl mx-auto px-4 py-10">
    <header class="flex items-center justify-between gap-4">
      <h1 class="text-2xl md:text-4xl font-bold tracking-tight">
        <span class="text-white/80">National ID</span>
        <span class="bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 to-blue-400"> Scanner</span>
      </h1>
      <div class="flex items-center gap-2">
        <a id="downloadLink" href="#" class="hidden px-3 py-2 rounded-xl bg-white/10 hover:bg-white/15 border border-white/15">Download JSON</a>
      </div>
    </header>

    <!-- Upload Zone -->
    <section class="mt-8 grid md:grid-cols-2 gap-6">
      <div class="relative group">
        <div id="frontDrop" class="aspect-[4/3] rounded-3xl border border-white/10 bg-white/5 backdrop-blur flex items-center justify-center overflow-hidden hover:border-cyan-400/40 transition">
          <div id="frontPreviewText" class="text-center p-6">
            <div class="text-xl opacity-80">Front Side</div>
            <div class="text-sm opacity-60">Drag & drop or click</div>
          </div>
          <img id="frontPreview" class="hidden w-full h-full object-cover" />
        </div>
        <div class="mt-3 flex gap-2">
          <input id="frontInput" type="file" accept="image/*" class="hidden" />
          <button onclick="document.getElementById('frontInput').click()" class="px-3 py-2 rounded-xl bg-white/10 hover:bg-white/15 border border-white/15">Choose File</button>
          <button id="clearFront" class="hidden px-3 py-2 rounded-xl bg-white/10 hover:bg-white/15 border border-white/15">Clear</button>
        </div>
      </div>

      <div class="relative group">
        <div id="backDrop" class="aspect-[4/3] rounded-3xl border border-white/10 bg-white/5 backdrop-blur flex items-center justify-center overflow-hidden hover:border-cyan-400/40 transition">
          <div id="backPreviewText" class="text-center p-6">
            <div class="text-xl opacity-80">Back Side</div>
            <div class="text-sm opacity-60">Drag & drop or click</div>
          </div>
          <img id="backPreview" class="hidden w-full h-full object-cover" />
        </div>
        <div class="mt-3 flex gap-2">
          <input id="backInput" type="file" accept="image/*" class="hidden" />
          <button onclick="document.getElementById('backInput').click()" class="px-3 py-2 rounded-xl bg-white/10 hover:bg-white/15 border border-white/15">Choose File</button>
          <button id="clearBack" class="hidden px-3 py-2 rounded-xl bg-white/10 hover:bg-white/15 border border-white/15">Clear</button>
        </div>
      </div>
    </section>

    <section class="mt-6">
      <button id="uploadBtn" class="px-5 py-3 rounded-2xl bg-gradient-to-r from-cyan-500 to-blue-500 shadow-lg shadow-cyan-500/20 hover:shadow-cyan-500/30">Generate JSON</button>
    </section>

    <!-- Result -->
    <section id="resultSection" class="hidden mt-10">
      <div class="grid md:grid-cols-3 gap-6">
        <div class="md:col-span-2 p-4 rounded-3xl border border-white/10 bg-white/5">
          <div class="text-sm text-white/60 mb-2">Preview</div>
          <div class="grid sm:grid-cols-2 gap-4">
            <div id="frontPreviewBox" class="hidden rounded-2xl overflow-hidden border border-white/10">
              <img id="frontResult" class="w-full h-full object-cover" />
            </div>
            <div id="backPreviewBox" class="hidden rounded-2xl overflow-hidden border border-white/10">
              <img id="backResult" class="w-full h-full object-cover" />
            </div>
          </div>
        </div>
        <div class="p-4 rounded-3xl border border-white/10 bg-white/5">
          <div class="text-sm text-white/60 mb-2">Session</div>
          <div id="sessionInfo" class="text-xs opacity-70"></div>
        </div>
      </div>

      <div class="mt-8">
        <h2 class="text-xl font-semibold mb-3">Extracted Fields</h2>
        <div id="fields" class="grid md:grid-cols-3 gap-4"></div>
      </div>

      <div class="mt-8">
        <h2 class="text-xl font-semibold mb-3">Raw JSON</h2>
        <pre id="rawJson" class="p-4 rounded-2xl bg-black/50 border border-white/10 overflow-auto text-xs"></pre>
      </div>
    </section>

    <footer class="mt-14 text-center text-white/40 text-xs">
      Built with ❤ — Futuristic glass UI, responsive, and JSON-first.
    </footer>
  </div>

  <script>
    const API_BASE = "http://localhost:8000"; // same-origin if you open http://localhost:8000/
    const frontInput = document.getElementById("frontInput");
    const backInput = document.getElementById("backInput");
    const frontPreview = document.getElementById("frontPreview");
    const backPreview = document.getElementById("backPreview");
    const frontPreviewText = document.getElementById("frontPreviewText");
    const backPreviewText = document.getElementById("backPreviewText");
    const clearFront = document.getElementById("clearFront");
    const clearBack = document.getElementById("clearBack");
    const uploadBtn = document.getElementById("uploadBtn");
    const resultSection = document.getElementById("resultSection");
    const sessionInfo = document.getElementById("sessionInfo");
    const fieldsContainer = document.getElementById("fields");
    const rawJson = document.getElementById("rawJson");
    const downloadLink = document.getElementById("downloadLink");

    function setPreview(input, preview, previewText, clearBtn) {
      const file = input.files[0];
      if (file) {
        const url = URL.createObjectURL(file);
        preview.src = url;
        preview.classList.remove("hidden");
        previewText.classList.add("hidden");
        clearBtn.classList.remove("hidden");
      }
    }

    frontInput.addEventListener("change", () => setPreview(frontInput, frontPreview, frontPreviewText, clearFront));
    backInput.addEventListener("change", () => setPreview(backInput, backPreview, backPreviewText, clearBack));

    clearFront.addEventListener("click", () => {
      frontInput.value = "";
      frontPreview.classList.add("hidden");
      frontPreviewText.classList.remove("hidden");
      clearFront.classList.add("hidden");
    });
    clearBack.addEventListener("click", () => {
      backInput.value = "";
      backPreview.classList.add("hidden");
      backPreviewText.classList.remove("hidden");
      clearBack.classList.add("hidden");
    });

    uploadBtn.addEventListener("click", async () => {
      if (!frontInput.files[0] || !backInput.files[0]) {
        alert("Please select both front and back images");
        return;
      }
      const fd = new FormData();
      fd.append("front", frontInput.files[0]);
      fd.append("back", backInput.files[0]);
      const res = await fetch(`${API_BASE}/api/upload`, { method: "POST", body: fd });
      if (!res.ok) {
        alert("Upload failed");
        return;
      }
      const data = await res.json();
      displayResult(data);
    });

    function displayResult(data) {
      resultSection.classList.remove("hidden");
      // Show processed temp images instead of original uploads
      document.getElementById("frontResult").src = `${API_BASE}/api/temp/front?t=${Date.now()}`;
      document.getElementById("frontPreviewBox").classList.remove("hidden");
      document.getElementById("backResult").src = `${API_BASE}/api/temp/back?t=${Date.now()}`;
      document.getElementById("backPreviewBox").classList.remove("hidden");
      sessionInfo.innerHTML = `ID: ${data.session_id}<br>Created: ${new Date(data.created_at).toLocaleString()}`;
      fieldsContainer.innerHTML = Object.entries(data.fields).map(([k,v]) => `
        <div class='flex flex-col p-3 rounded-2xl bg-white/5 backdrop-blur border border-white/10'>
          <span class='text-xs uppercase tracking-wider text-white/60'>${k}</span>
          <span class='text-base md:text-lg font-medium'>${v || "—"}</span>
        </div>
      `).join("");
      rawJson.textContent = JSON.stringify(data, null, 2);
      downloadLink.href = `${API_BASE}/api/result/${data.session_id}/download`;
      downloadLink.classList.remove("hidden");
    }

  </script>
</body>
</html>